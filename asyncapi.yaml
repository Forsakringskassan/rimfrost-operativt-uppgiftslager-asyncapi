asyncapi: 3.0.0
info:
  title: Operativt uppgiftslager API
  version: 1.1.0
  description: Operativt uppgiftslager för hantering av manuella uppgifter utförda av handläggare

channels:
  operativt.uppgiftslager.requests:
    messages:
      OperativtUppgiftslagerRequestMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerRequestMessage'
  operativt.uppgiftslager.responses:
    messages:
      OperativtUppgiftslagerResponseMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerResponseMessage'
  operativt.uppgiftslager.status:
    messages:
      OperativtUppgiftslagerStatusMessage:
        $ref: '#/components/messages/OperativtUppgiftslagerStatusMessage'
operations:
  operativtUppgiftslagerRequest:
    action: receive
    channel:
      $ref: '#/channels/operativt.uppgiftslager.requests'
    reply:
      address:
        description: Topic där response ska skickas
        location: "$message.header#/replyTo"
      channel:
        $ref: '#/channels/operativt.uppgiftslager.responses'
  operativtUppgiftslagerStatus:
    action: send
    channel:
      $ref: '#/channels/operativt.uppgiftslager.status'
    summary: Publicerar statusuppdateringar
components:
  schemas:
    Personnummer:
      type: string
      description: Svenskt personnummer (12 siffror med bindestreck)
      pattern: '^\d{8}-\d{4}$'
      example: "19990101-0123"
  messages:
    OperativtUppgiftslagerRequestMessage:
      headers:
        type: object
        properties:
          replyTo:
            type: string
            description: Topic där response ska skickas
          correlationId:
            type: string
            description: Unikt id som kopplar ihop request & response
      payload:
        type: object
        properties:
          processId:
            type: string
            description: Unikt id som identifierar processinstansen
          personnummer:
            $ref: '#/components/schemas/Personnummer'
          uppgiftsBeskrivning:
            type: string
            description: Beskrivning av vad handläggaren ska göra
      correlationId:
        $ref: "#/components/correlationIds/correlationId"
    OperativtUppgiftslagerResponseMessage:
      headers:
        type: object
        properties:
          correlationId:
            type: string
            description: Unikt id som kopplar ihop request & response
      payload:
        type: object
        properties:
          processId:
            type: string
            description: Unikt id som identifierar processinstansen
          personnummer:
            $ref: '#/components/schemas/Personnummer'
          resultat:
            type: string
            description: Utfall av uppgiften
          status:
            type: string
            description: Status för uppgiften
            enum:
              - Avslutad
    OperativtUppgiftslagerStatusMessage:
      payload:
        type: object
        properties:
          processId:
            type: string
            description: Unikt id som identifierar processinstansen
          personnummer:
            $ref: '#/components/schemas/Personnummer'
          resultat:
            type: string
            description: Utfall av uppgiften (endast relevant om status är Avslutad)
          status:
            type: string
            description: Status för uppgiften
            enum:
              - Ny
              - Tilldelad
              - Avslutad
  correlationIds:
    correlationId:
      location: '$message.header#/requestId'